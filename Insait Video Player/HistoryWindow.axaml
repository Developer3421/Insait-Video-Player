<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Insait_Video_Player"
        x:Class="Insait_Video_Player.HistoryWindow"
        Title="Історія перегляду"
        WindowStartupLocation="CenterOwner"
        SystemDecorations="None"
        Background="{DynamicResource AppBgBrush}"
        Width="700"
        Height="500"
        CanResize="False"
        UseLayoutRounding="True"
        FontFamily="Segoe UI, Arial, Tahoma">

    <Grid RowDefinitions="42,*">

        <!-- ROW 0: TITLE BAR -->
        <Grid Grid.Row="0" Name="TitleBar" Background="{DynamicResource GrayGradient}">
            <Grid ColumnDefinitions="Auto,*,Auto">

                <!-- Left: History icon + title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                    <Border Width="28" Height="28" CornerRadius="4" Background="{DynamicResource AccentOrangeBrush}" Margin="0,0,10,0">
                        <Viewbox Width="18" Height="18">
                            <Canvas Width="24" Height="24">
                                <Path Fill="{DynamicResource AccentPurpleBrush}" Data="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3"/>
                            </Canvas>
                        </Viewbox>
                    </Border>
                    <TextBlock Name="TitleText" Text="Історія перегляду"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource AppTextBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Middle: Draggable area -->
                <Panel Name="TitleBarDragArea" Grid.Column="1" Background="Transparent"/>

                <!-- Right: Close button -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Name="CloseButton" Classes="window-control close" Padding="0">
                        <Image Source="avares://Insait Video Player/Sources/CloseButton.png" Stretch="UniformToFill"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- ROW 1: Content area -->
        <Border Grid.Row="1" Classes="panel" Margin="8" Padding="0">
            <Grid RowDefinitions="Auto,*,Auto">
                
                <!-- Header with search and clear button -->
                <Border Grid.Row="0" Padding="16,12" BorderBrush="{DynamicResource AppBorderBrush}" BorderThickness="0,0,0,1">
                    <Grid ColumnDefinitions="*,Auto,Auto">
                        <!-- Search box -->
                        <TextBox Name="SearchBox"
                                 Grid.Column="0"
                                 Height="36"
                                 Watermark="Пошук..."
                                 Background="{DynamicResource AppSurfaceBrush}"
                                 BorderBrush="{DynamicResource AppBorderBrush}"
                                 BorderThickness="1"
                                 CornerRadius="8"
                                 Padding="12,0"
                                 FontSize="13"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,12,0"/>
                        
                        <!-- Clear history button -->
                        <Button Name="ClearHistoryButton"
                                Grid.Column="1"
                                Classes="toolbar-button"
                                Margin="0,0,8,0"
                                ToolTip.Tip="Очистити історію">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" 
                                          Width="14" Height="14" Foreground="{DynamicResource AccentPurpleBrush}"/>
                                <TextBlock Name="ClearButtonText" Text="Очистити" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Refresh button -->
                        <Button Name="RefreshButton"
                                Grid.Column="2"
                                Classes="toolbar-button"
                                Width="36" Padding="0"
                                ToolTip.Tip="Оновити">
                            <PathIcon Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" 
                                      Width="16" Height="16" Foreground="{DynamicResource AccentPurpleBrush}"/>
                        </Button>
                    </Grid>
                </Border>
                
                <!-- History list -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="8">
                    <ItemsControl Name="HistoryList">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="local:HistoryDisplayItem">
                                <Border Margin="4" Padding="12" Background="{DynamicResource AppSurfaceBrush}" 
                                        BorderBrush="{DynamicResource AppBorderBrush}" BorderThickness="1" CornerRadius="8">
                                    <Grid ColumnDefinitions="*,Auto,Auto">
                                        <!-- File info -->
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="2">
                                            <TextBlock Text="{Binding FileName}" FontWeight="SemiBold" FontSize="13"
                                                       Foreground="{DynamicResource AppTextBrush}"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding FilePath}" FontSize="11" 
                                                       Foreground="{DynamicResource AppTextMutedBrush}"
                                                       TextTrimming="CharacterEllipsis" MaxWidth="400"/>
                                        </StackPanel>
                                        
                                        <!-- Date/Time -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0" Spacing="2">
                                            <TextBlock Text="{Binding DateText}" FontSize="11" 
                                                       Foreground="{DynamicResource AppTextMutedBrush}"
                                                       HorizontalAlignment="Right"/>
                                            <TextBlock Text="{Binding TimeText}" FontSize="11" 
                                                       Foreground="{DynamicResource AppTextMutedBrush}"
                                                       HorizontalAlignment="Right"/>
                                        </StackPanel>
                                        
                                        <!-- Delete button -->
                                        <Button Grid.Column="2" Classes="tab-close" Width="28" Height="28" 
                                                Tag="{Binding}" ToolTip.Tip="Видалити з історії"
                                                Click="OnDeleteHistoryItem">
                                            <PathIcon Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
                                                      Width="12" Height="12" Foreground="{DynamicResource AppTextMutedBrush}"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                
                <!-- Empty state -->
                <StackPanel Name="EmptyState" Grid.Row="1" IsVisible="False"
                            VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                    <PathIcon Data="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3" 
                              Width="48" Height="48" Foreground="{DynamicResource AppTextMutedBrush}" Opacity="0.5"/>
                    <TextBlock Name="EmptyStateText" Text="Історія порожня" FontSize="14" 
                               Foreground="{DynamicResource AppTextMutedBrush}" HorizontalAlignment="Center"/>
                </StackPanel>
                
                <!-- Status bar -->
                <Border Grid.Row="2" Padding="16,8" BorderBrush="{DynamicResource AppBorderBrush}" BorderThickness="0,1,0,0">
                    <TextBlock Name="StatusText" Text="0 записів" FontSize="12" 
                               Foreground="{DynamicResource AppTextMutedBrush}"/>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>

