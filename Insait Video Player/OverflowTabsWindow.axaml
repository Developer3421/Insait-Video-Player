<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Insait_Video_Player"
        x:Class="Insait_Video_Player.OverflowTabsWindow"
        x:DataType="local:OverflowTabsWindow"
        Title="Додаткові вкладки"
        WindowStartupLocation="CenterOwner"
        SystemDecorations="None"
        Background="{DynamicResource AppBgBrush}"
        Width="500"
        Height="400"
        CanResize="False"
        UseLayoutRounding="True"
        FontFamily="Segoe UI, Arial, Tahoma">

    <Grid RowDefinitions="42,*">

        <!-- ROW 0: TITLE BAR -->
        <Grid Grid.Row="0" Name="TitleBar" Background="{DynamicResource GrayGradient}">
            <Grid ColumnDefinitions="Auto,*,Auto">

                <!-- Left: icon + title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                    <Border Width="28" Height="28" CornerRadius="4" Background="Transparent" Margin="0,0,10,0" ClipToBounds="True">
                        <Image Source="avares://Insait Video Player/Sources/Insait Video Player.png" 
                               Width="28" Height="28" Stretch="Uniform"/>
                    </Border>
                    <TextBlock Name="TitleText" Text="Додаткові вкладки"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource AppTextBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Middle: Draggable area -->
                <Panel Name="TitleBarDragArea" Grid.Column="1" Background="Transparent"/>

                <!-- Right: Close button -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Name="CloseButton" Classes="window-control close" Padding="0">
                        <Image Source="avares://Insait Video Player/Sources/CloseButton.png" Stretch="UniformToFill"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- ROW 1: Content area -->
        <Border Grid.Row="1" Classes="panel" Margin="8" Padding="0">
            <Grid RowDefinitions="Auto,*,Auto">
                
                <!-- Header with Add tab button -->
                <Border Grid.Row="0" Padding="16,12" BorderBrush="{DynamicResource AppBorderBrush}" BorderThickness="0,0,0,1">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Name="HeaderText" Grid.Column="0" Text="Вкладки в overflow" 
                                   FontSize="14" FontWeight="SemiBold"
                                   Foreground="{DynamicResource AppTextBrush}"
                                   VerticalAlignment="Center"/>
                        
                        <!-- Add tab button -->
                        <Button Name="AddTabButton" Grid.Column="1"
                                Classes="toolbar-button"
                                ToolTip.Tip="Створити нову вкладку">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Image Source="avares://Insait Video Player/Sources/AddTab.png" Width="20" Height="20" Stretch="Uniform"/>
                                <TextBlock Name="NewTabButtonText" Text="Нова вкладка" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </Border>
                
                <!-- Tabs list -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="8">
                    <ItemsControl Name="TabsList">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="local:OverflowTabDisplayItem">
                                <Border Margin="4" Padding="12" Background="{DynamicResource AppSurfaceBrush}" 
                                        BorderBrush="{DynamicResource AppBorderBrush}" BorderThickness="1" CornerRadius="8"
                                        Cursor="Hand">
                                    <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                                        <!-- Play/Activate button -->
                                        <Button Grid.Column="0" Width="40" Height="40" Padding="0"
                                                Background="{DynamicResource AccentOrangeBrush}" 
                                                BorderBrush="{DynamicResource AccentPurpleBrush}"
                                                BorderThickness="2" CornerRadius="8" 
                                                Margin="0,0,12,0" VerticalAlignment="Center"
                                                Tag="{Binding}" Click="OnActivateTab"
                                                ToolTip.Tip="Активувати вкладку">
                                            <Viewbox Width="20" Height="20">
                                                <Canvas Width="24" Height="24">
                                                    <Path Fill="{DynamicResource AccentPurpleBrush}" Data="M8,5V19L19,12Z"/>
                                                </Canvas>
                                            </Viewbox>
                                        </Button>
                                        
                                        <!-- Tab info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                                            <TextBlock Text="{Binding Title}" FontWeight="SemiBold" FontSize="13"
                                                       Foreground="{DynamicResource AppTextBrush}"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding FilePath}" FontSize="11" 
                                                       Foreground="{DynamicResource AppTextMutedBrush}"
                                                       TextTrimming="CharacterEllipsis" MaxWidth="280"/>
                                        </StackPanel>
                                        
                                        <!-- Move to main button -->
                                        <Button Grid.Column="2" Classes="toolbar-button" Width="32" Height="32" 
                                                Margin="8,0" Padding="0"
                                                Tag="{Binding}" Click="OnMoveToMain"
                                                ToolTip.Tip="Перемістити в головне вікно">
                                            <PathIcon Data="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" 
                                                      Width="14" Height="14" Foreground="{DynamicResource AccentPurpleBrush}"/>
                                        </Button>
                                        
                                        <!-- Delete button -->
                                        <Button Grid.Column="3" Classes="tab-close" Width="28" Height="28" 
                                                Tag="{Binding}" Click="OnDeleteTab"
                                                ToolTip.Tip="Закрити вкладку">
                                            <PathIcon Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
                                                      Width="12" Height="12" Foreground="{DynamicResource AppTextMutedBrush}"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                
                <!-- Empty state -->
                <StackPanel Name="EmptyState" Grid.Row="1" IsVisible="False"
                            VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                    <PathIcon Data="M19,4H5A2,2 0 0,0 3,6V18A2,2 0 0,0 5,20H19A2,2 0 0,0 21,18V6A2,2 0 0,0 19,4M5,18V8H19V18H5Z" 
                              Width="48" Height="48" Foreground="{DynamicResource AppTextMutedBrush}" Opacity="0.5"/>
                    <TextBlock Name="EmptyStateText" Text="Немає додаткових вкладок" FontSize="14" 
                               Foreground="{DynamicResource AppTextMutedBrush}" HorizontalAlignment="Center"/>
                </StackPanel>
                
                <!-- Status bar -->
                <Border Grid.Row="2" Padding="16,8" BorderBrush="{DynamicResource AppBorderBrush}" BorderThickness="0,1,0,0">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Name="StatusText" Text="0 / 4 вкладок" FontSize="12" 
                                   Foreground="{DynamicResource AppTextMutedBrush}" VerticalAlignment="Center"/>
                        <TextBlock Name="MaximumText" Grid.Column="1" Text="Максимум: 4" FontSize="11" 
                                   Foreground="{DynamicResource AppTextMutedBrush}" VerticalAlignment="Center" Opacity="0.7"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>

